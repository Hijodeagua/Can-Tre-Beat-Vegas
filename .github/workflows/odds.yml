name: Run notebook daily

on:
  schedule:
    # Runs every day at 13:00 UTC (9:00 AM Eastern during EDT; 8:00 AM during EST)
    - cron: "0 13 * * *"
  workflow_dispatch: {}

permissions:
  contents: write  # required to push changes back

jobs:
  run-notebook:
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"
          cache: "pip"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Option A (recommended): run with papermill so outputs are saved
      - name: Execute notebook with papermill
        run: |
          papermill pull_in_odds_api_data.py pull_in_odds_api_data.py

      # If your notebook needs secrets (API keys), expose them as env vars:
      # env:
      #   MY_API_KEY: ${{ secrets.MY_API_KEY }}

      - name: Commit and push changes (if any)
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: daily notebook run"
          file_pattern: |
            data/**
            pull_in_api_data.ipynb
